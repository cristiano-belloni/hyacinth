<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Hyacinth</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="./assets/css/bootstrap.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
    </style>
    <link href="./assets/css/bootstrap-responsive.css" rel="stylesheet">
    <link href="./assets/css/obsidian.css" rel="stylesheet">
    <link href="./assets/css/hyacinth.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../assets/js/html5shiv.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
      <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
                    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">
                                   <link rel="shortcut icon" href="../assets/ico/favicon.png">
  </head>

  <body body data-spy="scroll" data-offset="85" data-target=".hy-docs-sidebar">

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="brand" href="#">Hyacinth</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li><a href="hyacinth.html">Hyacinth</a></li>
              <li><a href="#host">Host</a></li>
              <li><a href="#plugins">Plugins</a></li>
              <li><a href="#alone">Standalone</a></li>
              <li class="active"><a href="#">Docs</a></li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contact <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="#">Action</a></li>
                  <li><a href="#">Another action</a></li>
                  <li><a href="#">Something else here</a></li>
                  <li class="divider"></li>
                  <li class="nav-header">Nav header</li>
                  <li><a href="#">Separated link</a></li>
                  <li><a href="#">One more separated link</a></li>
                </ul>
              </li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container-fluid" id="main-container">
      <div class="row-fluid">
        <div class="span3">
          <div data-spy="affix" class="well sidebar-nav hy-docs-sidebar">
            <ul class="nav nav-list">
              <li class="nav-header">Plugin Repositories</li>
              <li class="active"><a href="#repo_structure">Structure of a plugin repository</a></li>
              <li class="nav-header">Plugin modules</li>
              <li><a href="#module_structure">Structure</a></li>
              <li><a href="#conf_object">The pluginConf configuration object</a></li>
              <li><a href="#constructor">The initPlugin constructor</a></li>
              <li><a href="#plugin_state">Plugin State</a></li>
              <li><a href="#host_interface">Interfacing with the Host</a></li>
              <li><a href="#arguments">Plugin arguments</a></li>
              <li><a href="#osc">Communication with OSC</a></li>
            </ul>
          </div><!--/.well -->
        </div><!--/span-->

      <div class="span9">
      <!-- Main hero unit for a primary marketing message or call to action -->
      <div class="hero-unit">
          <img src="./assets/img/hy_logo.png">
          <div>
            <h1>Hyacinth-docs</h1>
            <hr/>
            <p>Learn about Hyacinth.</p>
          </div>
      </div>

      <hr/>

      <section id="repo_structure">
      <h2>Plugin Repositories</h2>
      
      <h3>Structure of a plugin repository</h3>

      <p>A Hyacinth collection of plugins usually is stored in a Github repository. Every plugin in a repository is contained in its subdirectory. Plugin subdirectories are located under an always-present first-level subdirectory, called <code>hy-plugins</code>.</p>

      <p>Each plugin subdirectory name corresponds to the name of the plugin. That’s how an Hyacinth host figures out the plugin name. If, for example, you are developing a plugin you want to call “Foo”, its plugin subdirectory, relative to the repository root, will be <code>/hy-plugins/Foo/</code></p>

      <p>A Hyacinth plugin is required to have a javascript module file, located under its plugin subdirectory, whose name is the plugin's name and whose extension is <code>.js</code>. So, the module file for your Foo plugin will be <code>/plugins/Foo/Foo.js</code></p>

      <p>Other files can be stored in the plugin subdirectory. Their name and location can be chosen at will, as long as they’re under your plugin subdirectory, since they have no particular meaning for the host and it will ignore them.</p>

      <p>See an example of plugin repository schema below (or take a look at the <a>standard plugin repository</a>):</p>

      <pre>
Repository root
|
+---hy-plugins (always present)
    |
    +---Foo (plugin subdir for the Foo plugin)
    |   |
    |   +--- Foo.js (module file for Foo)
    |   |
    |   +--- assets
    |        |
    |        +---fooImage.png
    |
    +---Bar (plugin subdir for the Bar plugin)
        |
        +--- Bar.js (module file for Bar)</pre>
            
      </section>
      
      <section id="module_structure">
      <h2>Plugin modules</h2>

      <h3>Structure of a plugin module file</h3>

      <p>A Hyacinth plugin module file is a <a>Javascript AMD module</a>. When loaded by the host, it immediately returns an object composed by the plugin’s configuration object, called <code>pluginConf</code>, and the plugin constructor function, called <code>initPlugin</code>. The plugin module is dependent to the AMD <code>require</code> function, which it can use to load its asynchronous resources in autonomy.</p>

      <p>Here' s an example of a bare-bones plugin module file:</p>

      <pre><code data-language="javascript">
define(['require'], function(k2, require) {
  /* This object is returned to the host as soon as
   * the plugin is loaded */
  var pluginConf = {
    /* ... */
  };

  /* This function is called by the host every time a plugin INSTANCE
  * is required [e.g: requested by the Add Plugin button] */
  var initPlugin = function(initArgs) {
    /* ... */
  };
            
  return {
    /* The plugin returns this object when loaded by the host */
    initPlugin: initPlugin,
    pluginConf: pluginConf
  };
});
      </code></pre>

    </section>


    <hr>



    <section id="conf_object">
    <h3>The pluginConf configuration object</h3>

    <pre><code data-language="javascript">
var pluginConf = {
    version: {
      major: 1,
      minor: 2,
      maintenance: 3,
      desc: "Foo v1.2.3 (codename Bar)"
    },
    osc: true,   // OSC enabled
    audioIn: 4,  // Number of audio inputs
    audioOut: 1, // Number of audio outputs
    ui: {    // Request a canvas for the GUI
        type: 'canvas',
        width: 488,
        height: 164
    }
};</code></pre>

<p><code>pluginConf</code> is the plugin configuration object. It describes what the host should provide to the constructor function, through the arguments, in order to create an instance of the plugin.</p>
<p>This object is evaluated only once by the host, at plugin load. It should not change during the lifetime of the host session.</p>
<p><code>pluginConf</code> accepts these parameters:</p>

<table class="table table-bordered table-hover table-striped">
  <caption>pluginConf parameters</caption>
  <thead>
    <tr>
      <th> Parameter name</th>
      <th> Type</th>
      <th> Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>osc</code></td>
      <td>boolean</td>
      <td>If this parameter is true, the plugin is OSC-enabled. The host will pass an instance-specific OSC handler to the constructor function every time a new plugin instance is initialized.</td>
    </tr>
    <tr>
      <td><code>version</code></td>
      <td>object</td>
      <td>The plugin's version object. Version is expressed as <em>major.minor.patch</em></td>
    </tr>
    <tr>
      <td><code>version.major</code></td>
      <td>int ≥ 0</td>
      <td>The version's major number. Must be defined if version is defined.</td>
    </tr>
    <tr>
      <td><code>version.minor</code></td>
      <td>int ≥ 0</td>
      <td>The version's minor number. If undefined or null, it will always be compared as lower than other defined minor numbers.</td>
    </tr>
    <tr>
      <td><code>version.patch</code></td>
      <td>int ≥ 0</td>
      <td>The version's patch number. If undefined or null, it will always be compared as lower than other defined patch numbers. Can be ignored by the host if minor is undefined or null.</td>
    </tr>
    <tr>
      <td><code>version.desc</code></td>
      <td>string</td>
      <td>A human-readable (string) description of the version. Can be a codename or a brief description. Has no influence on comparing versions.</td>
    </tr>
   <tr>
      <td><code>audioIn</code></td>
      <td>int ≥ 0</td>
      <td>The number of distinct audio inputs the plugin will handle. This number <strong>doesn't</strong> represent the stereo or mono-ness of the audio inputs.</td>
    </tr>
    <tr>
      <td><code>audioOut</code></td>
      <td>int ≥ 0</td>
      <td>The number of distinct audio outputs the plugin will handle. This number <strong>doesn't</strong> represent the stereo or mono-ness of the audio outputs.</td>
    </tr> 
    <tr>
      <td><code>ui</code></td>
      <td>object</td>
      <td>If this object is defined, the host will create an HTML5 element to pass to the plugin instance.</td>
    </tr>
    <tr>
      <td><code>ui.type</code></td>
      <td>string</td>
      <td>If this string is <code>canvas</code>, an instance-specific <a>HTML5 canvas element</a>, will be passed to the constructor function every time a new plugin instance is initialized. If this string is <code>div</code>, a <a>div</a> will be passed instead. The element passed should be of size <code>ui.width</code> &times; <code>ui.height</code>, if these are defined.</td>
    </tr>
    <tr>
      <td><code>ui.width</code></td>
      <td>int ≥ 0</td>
      <td>UI width.</td>
    </tr>
    <tr>
      <td><code>ui.height</code></td>
      <td>int ≥ 0</td>
      <td>UI height.</td>
    </tr>
  </tbody>
</table>

    </section>


<section id="constructor">

  <h3>The initPlugin constructor</h3>

<pre><code data-language="javascript">
var initPlugin = function(initArgs) {
    /*  Process the arguments
        [...]
    */

    /*  Load resources
        [...]
    */

    if (fatalError) {
      /*  Cleanup code
          [...]
      */

      /* Fatal error occurred: set the state in HyInterface */
      args.HyInterface.setInstanceState ('fatal', {description: errorMsg});
      return;
    }

    /* Plugin is ready */
    args.HyInterface.setInstanceState ('ready');

};</code></pre>

  <p><code>initPlugin</code> is the plugin constructor function. When a new plugin instance is created by the host, <code>new</code> is called on <code>initPlugin</code> to initialize a new instance object. This function is therefore responsible of creating a <em>plugin instance</em>. This includes loading resources, when needed, initializing the plugin, and changing the state of the plugin when the initialization phase is over (see the <a href="#plugin_state">Plugin State section</a>)</p>
  <p>We will examine the arguments passed to this function later, in the <a href="#arguments">Plugin Arguments section</a>.
  </p>

  </section>

  <section id="plugin_state">

    <h3>Plugin State</h3>

    <p>Every plugin instance, in its lifetime, has a state, assigned at init-time by the host. Everytime a plugin changes state, the host is notified via the <a href="#host_interface">Host Interface</a> mechanism. The possible states of a plugin are listed in the following table:
    </p>

    <table class="table table-bordered table-hover table-striped">
      <caption>plugin instance states</caption>
      <thead>
        <tr>
          <th> State</th>
          <th> Meaning</th>
          <th> Behaviour</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>init</code></td>
          <td>The plugin instance is non-functional because it is initializing or loading resources. It can became functional later.</td>
          <td>This is the default state on plugin creation. The plugin is not functional, awaiting for its initialization tasks to complete. This is a temporary state, which will be changed as soon the initialization is complete or a fatal error is encountered. The host can display a temporary message warning the user that the plugin is being initialized.</td>
        </tr>
        <tr>
          <td><code>fatal</code></td>
          <td>The plugin instance is non-functional because it encountered a non-recoverable error. The plugin instance will never be functional.</td>
          <td>This state is the fatal error state. The plugin instance encountered an un-recoverable error during its initialization or at run time. This is a "terminal" state, which should never be changed again by the plugin instance. The host can display a message warning the user that the plugin instance is in an error state, or destroy the plugin object right away.</td>
        </tr>
        <tr>
          <td><code>ready</code></td>
          <td>The plugin instance is functional and ready to be used.</td>
          <td>After completing initialization, and having not encountered a fatal error, a plugin instance signals that it is in the ready state. The plugin is functional and ready to be used. This state can change to the fatal state if a fatal error is encountered, or back to the init state if the plugin needs to perform offline operations that would put it in a non-functional state (loading additional resources, or a long non-real-time calculation, for example).</td>
        </tr>
      </tbody>
    </table>

  </section>

  <section id="host_interface">
    <h3>Interfacing with the Host</h3>
    <p>
      A plugin instance can communicate with the host, to notify a change on its <a href="plugin_states">state</a> or to get informations about other plugins.
    </p>
    <p>
      An interface object is passed in the arguments (read more about the arguments passed to a plugin instance in the <a href="#arguments">Plugin Arguments section</a>). The object exposes these functions:
    </p>

    <dl>
      <dt><h4>setInstanceState</h4></dt>
      <dd><h5>Parameters</h5> <code><em>string</em> state, <em>object</em> options</code></dd>
      <dd><h5>Return value</h5> <em>none</em></dd>
      <dd><h5>Description</h5> <p>Set the instance state, as described in <a href="#plugin_state">this section</a>. Accepted values for the parameter a re <code>init</code>, <code>fatal</code> and <code>ready</code>. If <code>state === 'fatal'</code>, <code>options.description</code> can be specified to provide a description for the fatal event.</p></dd>
    </dl>


    <dl>
      <dt><h4>getOSCInstances</h4></dt>
      <dd><h5>Parameters</h5> <em>none</em></dd>
      <dd><h5>Return value</h5> an <code>Array</code> of OSC-enabled <code>pluginInstanceDesc</code>, where <code>pluginInstanceDesc.id</code> is the unique id of the instance, <code>pluginInstanceDesc.pluginName</code> is the instance's plugin name and <code>pluginInstanceDesc.pluginCustomName</code> is the instance's custom name (if the host doesn't support user-defined instance names, this is equal to <code>pluginInstanceDesc.pluginName</code>.</dd>
      <dd><h5>Description</h5> <p>Get a list of OSC-enabled plugin instances present in the current session. A plugin instance can request such a list for OSC discovery. By convention, the host should return only instances in their <code>ready</code> state. The field <code>pluginInstanceDesc.pluginCustomName</code> can be specified if the host supports custom (user-defined) names for instances. Otherwise, it should be equal to <code>pluginInstanceDesc.pluginName</code>. <code>pluginInstanceDesc.id</code> is an id, generated by the host, that uniquely identifies a given plugin instance.</p></dd>
    </dl>

  </section>

    <section id="arguments">
      <h3>Plugin arguments</h3>

      <pre><code data-language="javascript">
/* Plugin name */
var name = initArgs.name;

/* Unique id of this instance */
var id = initArgs.id;

/* Length same as audioIn, audioOut */
var nOfInChannels = initArgs.audioSources.length;
var nOfOutChannels = initArgs.audioDestinations.length;
    
/* AudioNode arrays */
var audioSources = initArgs.audioSources;
var audioDestinations = initArgs.audioDestinations;
    
/* Main AudioContext */
var context = initArgs.audioContext;
</code></pre>

      <p>Each plugin instance gets an initArgs object from the host. The arguments passed from the host to the plugin instance are described in the following table:</p>

      <table class="table table-bordered table-hover table-striped">
      <caption>initArgs arguments</caption>
      <thead>
        <tr>
          <th> Parameter name</th>
          <th> Type</th>
          <th> Description</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>id</code></td>
          <td>string</td>
          <td>This is the instance's unique identifier, generated by the host.</td>
        </tr>
        <tr>
          <td><code>name</code></td>
          <td>string</td>
          <td>This is the plugin name, loaded by the host. Two distinct instances of the same plugin will have the same name but different ids.</td>
        </tr>
        <tr>
          <td><code>audioSources</code></td>
          <td>Array</td>
          <td>An array of AudioSources. Its length must correspond to <code>pluginConf.audioIn</code>. An AudioSource has not to be an Web Audio API AudioNode, but it should respect the <a href="https://dvcs.w3.org/hg/audio/raw-file/tip/webaudio/specification.html#AudioNode-section">Audio Node interface</a>.</td>
        </tr>
        <tr>
          <td><code>audioDestinations</code></td>
          <td>Array</td>
          <td>An array of AudioDestinations. Its length must correspond to <code>pluginConf.audioOut</code>. An AudioDestinations has not to be an Web Audio API AudioNode, but it should respect the <a href="https://dvcs.w3.org/hg/audio/raw-file/tip/webaudio/specification.html#AudioNode-section">Audio Node interface</a>.</td>
        </tr>
        <tr>
          <td><code>audioContext</code></td>
          <td>Object</td>
          <td>An object, representing the real-time main Audio context, generated by the host. The audioContext has not to be an Web Audio API AudioNode, but it should respect the <a href="https://dvcs.w3.org/hg/audio/raw-file/tip/webaudio/specification.html#AudioContext-section">Audio Context interface</a>.</td>
        </tr>
        <tr>
          <td><code>hostInterface</code></td>
          <td>Object</td>
          <td>An object that contains the methods used by the plugin instance to communicate with the host. See a description of the methods in the <a href="http://localhost:8000/hyacinth/docs.html#host_interface"><em>Interfacing with the host</em> section</a>.</td>
        </tr>
        <tr>
          <td><code>OSCHandler</code></td>
          <td>Object</td>
          <td>An object that contains the methods used by the plugin instance to communicate with other plugins via <a>Open Sound Control</a>. Read more about OSC support in the host in the <a href="http://localhost:8000/hyacinth/docs.html#osc"><em>Communication with OSC</em> section</a>.</td>
        </tr>
      </tbody>
    </table>

  </section>

    <section id="osc">
    <h3>Sending and receiving OSC</h3>

    <pre><code data-language="javascript">
/* The OSC handler */
this.OSChandler = args.OSCHandler;
// Callback. Called when an OSC message arrives
var oscCallback = function (message) {
    console.log (this.id + " received message: ", message);
    var dest = message[0];      // osc path
    var argument1 = message[1]; // parse the message array
};

// Register the client
this.oscClient = this.OSChandler.registerClient (
    { clientID : this.id,
      oscCallback : oscCallback.bind (this) }
);
// You can send osc messages with:
var msg = new K2.OSC.Message('/path/of/outbound/message', arg1, arg2, argN);
this.oscClient.sendOSC(msg);
    </code></pre>

    
    <p>A plugin can send and receive OSC messages to and from other plugins and to and from a remote OSC-capable host in the net (using KievII’s OSCProxy server).</p>

    <p>A KievII OSCHandler object is created by the host and passed to the constructor through args.OSCHandler.</p>

    <p>The first thing a plugin will do is to obtain an oscClient object and set a callback for incoming OSC messages, calling the registerClient method of the OSCHandler.</p>

    <p>A plugin can also create an OSC message (initializing a new K2.OSC.Message object) and send that message using the sendOSC method of the previously-mentioned oscClient.</p>

    <p>OSC messages are not connected from a plugin instance to a particular other plugin instance, like audio inputs / outputs are.
        This means that when a plugin instance sends an OSCMessage with the sendOSC method, every other instance of every other plugin present in the session will receive the message. OSC messages are always broadcast.</p>

    <p>It’s likely that this behaviour will change, in the future. Until then, a plugin must filter out the messages it wants to ignore in the OSC callback.</p>

    <p>OSC is based on KievII library OSC implementation. The code is still under active developement, any contribution to improve it are accepted and encouraged.</p>
  </section>

      <hr>

      <footer>
        <p>&copy; bitterspring.net 2013</p>
      </footer>

     </div>
    </div> <!-- /container -->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="./assets/js/jquery-1.9.1.min.js"></script>
    <script src="./assets/js/bootstrap.min.js"></script>
    <script src="assets/js/rainbow-custom.min.js"></script>
    <!-- <script src="../assets/js/bootstrap-alert.js"></script>
    <script src="../assets/js/bootstrap-modal.js"></script>
    <script src="../assets/js/bootstrap-dropdown.js"></script>
    <script src="../assets/js/bootstrap-scrollspy.js"></script>
    <script src="../assets/js/bootstrap-tab.js"></script>
    <script src="../assets/js/bootstrap-tooltip.js"></script>
    <script src="../assets/js/bootstrap-popover.js"></script>
    <script src="../assets/js/bootstrap-button.js"></script>
    <script src="../assets/js/bootstrap-collapse.js"></script>
    <script src="../assets/js/bootstrap-carousel.js"></script>
    <script src="../assets/js/bootstrap-typeahead.js"></script> -->
  </body>
</html>
